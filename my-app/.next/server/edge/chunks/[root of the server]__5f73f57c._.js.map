{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 31, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.js"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport jwt from \"jsonwebtoken\";\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET;\r\nif (!JWT_SECRET) {\r\n  throw new Error(\"JWT_SECRET is not defined in environment variables\");\r\n}\r\n\r\nexport function middleware(req) {\r\n  console.log(\"Middleware triggered for:\", req.nextUrl.pathname);\r\n  const { pathname } = req.nextUrl;\r\n\r\n  const userToken = req.cookies.get(\"usertoken\")?.value;\r\n  const adminToken = req.cookies.get(\"admintoken\")?.value;\r\n\r\n  // Protect /signup/adminlogin/* routes\r\n  if (pathname.startsWith(\"/signup/adminlogin\")) {\r\n    if (userToken) {\r\n      console.log(\"❌ User token present for admin route\");\r\n      return NextResponse.redirect(new URL(\"/signup/loginasadmin\", req.url));\r\n    }\r\n    if (!adminToken) {\r\n      console.log(\"❌ No admin token\");\r\n      return NextResponse.redirect(new URL(\"/signup/loginasadmin\", req.url));\r\n    }\r\n    try {\r\n      const decoded = jwt.verify(adminToken, JWT_SECRET);\r\n      if (decoded.role !== \"admin\") {\r\n        console.log(\"❌ Token does not have admin role\");\r\n        return NextResponse.redirect(new URL(\"/signup/loginasadmin\", req.url));\r\n      }\r\n    } catch (err) {\r\n      console.error(\"❌ Admin token error:\", err.name, err.message);\r\n      return NextResponse.redirect(new URL(\"/signup/loginasadmin\", req.url));\r\n    }\r\n  }\r\n\r\n  // Protect /signup/userlogin/* routes\r\n  if (pathname.startsWith(\"/signup/userlogin\")) {\r\n    if (adminToken) {\r\n      console.log(\"❌ Admin token present for user route\");\r\n      return NextResponse.redirect(new URL(\"/signup/loginasuser\", req.url));\r\n    }\r\n    if (!userToken) {\r\n      console.log(\"❌ No user token\");\r\n      return NextResponse.redirect(new URL(\"/signup/loginasuser\", req.url));\r\n    }\r\n    try {\r\n      const decoded = jwt.verify(userToken, JWT_SECRET);\r\n      if (decoded.role === \"admin\") {\r\n        console.log(\"❌ Admin token used for user route\");\r\n        return NextResponse.redirect(new URL(\"/signup/loginasuser\", req.url));\r\n      }\r\n    } catch (err) {\r\n      console.error(\"❌ User token error:\", err.name, err.message);\r\n      return NextResponse.redirect(new URL(\"/signup/loginasuser\", req.url));\r\n    }\r\n  }\r\n\r\n  return NextResponse.next();\r\n}\r\n\r\nexport const config = {\r\n  matcher: [\"/signup/adminlogin/:path*\", \"/signup/userlogin/:path*\"],\r\n};"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEA,MAAM;AACN,uCAAiB;;AAEjB;AAEO,SAAS,WAAW,GAAG;IAC5B,QAAQ,GAAG,CAAC,6BAA6B,IAAI,OAAO,CAAC,QAAQ;IAC7D,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,OAAO;IAEhC,MAAM,YAAY,IAAI,OAAO,CAAC,GAAG,CAAC,cAAc;IAChD,MAAM,aAAa,IAAI,OAAO,CAAC,GAAG,CAAC,eAAe;IAElD,sCAAsC;IACtC,IAAI,SAAS,UAAU,CAAC,uBAAuB;QAC7C,IAAI,WAAW;YACb,QAAQ,GAAG,CAAC;YACZ,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,wBAAwB,IAAI,GAAG;QACtE;QACA,IAAI,CAAC,YAAY;YACf,QAAQ,GAAG,CAAC;YACZ,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,wBAAwB,IAAI,GAAG;QACtE;QACA,IAAI;YACF,MAAM,UAAU,6IAAA,CAAA,UAAG,CAAC,MAAM,CAAC,YAAY;YACvC,IAAI,QAAQ,IAAI,KAAK,SAAS;gBAC5B,QAAQ,GAAG,CAAC;gBACZ,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,wBAAwB,IAAI,GAAG;YACtE;QACF,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,wBAAwB,IAAI,IAAI,EAAE,IAAI,OAAO;YAC3D,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,wBAAwB,IAAI,GAAG;QACtE;IACF;IAEA,qCAAqC;IACrC,IAAI,SAAS,UAAU,CAAC,sBAAsB;QAC5C,IAAI,YAAY;YACd,QAAQ,GAAG,CAAC;YACZ,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,uBAAuB,IAAI,GAAG;QACrE;QACA,IAAI,CAAC,WAAW;YACd,QAAQ,GAAG,CAAC;YACZ,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,uBAAuB,IAAI,GAAG;QACrE;QACA,IAAI;YACF,MAAM,UAAU,6IAAA,CAAA,UAAG,CAAC,MAAM,CAAC,WAAW;YACtC,IAAI,QAAQ,IAAI,KAAK,SAAS;gBAC5B,QAAQ,GAAG,CAAC;gBACZ,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,uBAAuB,IAAI,GAAG;YACrE;QACF,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,uBAAuB,IAAI,IAAI,EAAE,IAAI,OAAO;YAC1D,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,uBAAuB,IAAI,GAAG;QACrE;IACF;IAEA,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;QAA6B;KAA2B;AACpE"}}]
}